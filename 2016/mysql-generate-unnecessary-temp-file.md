## 1 现象
12月1日起观测到某服务器系统盘占用超过90%触发报警，但很快又自发回落，涉及到的文件大小应在3G以上。整个过程一般持续10至15分钟，每数小时出现一次，出现时机似无规律。
## 2 大致问题定位
在问题主机上添加磁盘占用监控脚本，内容包括df及系统盘du信息，每分钟执行一次。观察结果为df显著增长时，du信息无任何变化。<br>
此时yilin提出检查lsof，将lsof写入监控脚本观察。后终有所获。<br>
通过进程号查询可定位问题出现在该主机的mysql实例1上。

## 3 定位问题SQL

Mysql写临时文件的情况有两种，其一是写binlog，其二是查询时使用文件排序或生成临时表。但组内的设置使得binlog并不会打在系统盘内，可能性就只有因查询生成了。这时候就像看慢查询日志，但很遗憾，慢查询功能没开。于是改用土办法：磁盘占用量暴增时脚本连接mysql执行show processlist打出结果。经过漫长的守株待兔，截获这样一条可疑语句：
```sql
select ip_head,ip_tail,isp_id,city_id,province_id from ip_code order by ip_head limit 4500000,14694
```
